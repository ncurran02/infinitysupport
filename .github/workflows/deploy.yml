name: Deploy website

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: deployment

    steps:
    - name: üì• Checkout repo
      uses: actions/checkout@v3
    
    - name: Check SSH key presence
      run: |
        if [ -z "${{ secrets.SSH_PRIVATE_KEY }}" ]; then
          echo "SSH_PRIVATE_KEY is empty"
          exit 1
        else
          echo "SSH_PRIVATE_KEY is set"
        fi

    # - name: üß± Build React
    #   run: |
    #     npm ci
    #     npm run build

    # - name: üì§ Deploy build to server via SCP
    #   uses: appleboy/scp-action@v1
    #   with:
    #     host: ${{ secrets.HOST }}
    #     username: ${{ secrets.USERNAME }}
    #     port: ${{ secrets.PORT }}
    #     key: ${{ secrets.SSH_PRIVATE_KEY }}
    #     source: "build/*"
    #     target: "/var/www/infinitysupportservices.com.au/"

    # - name: üîÅ Reload Caddy
    #   uses: appleboy/ssh-action@v1
    #   with:
    #     host: ${{ secrets.HOST }}
    #     username: ${{ secrets.USERNAME }}
    #     port: ${{ secrets.PORT }}
    #     key: ${{ secrets.SSH_PRIVATE_KEY }}
    #     script: |
    #       echo "Reloading Caddy..."
    #       sudo systemctl reload caddy